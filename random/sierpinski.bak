#lang racket

(define (fill-random window dim prob colour n)
  (display dim)
  (display " -- ")
  (display n)
  (define (iter n count)
    (let* ((rand-x (+ (get-x dim) (random (get-w dim))))
           (rand-y (+ (get-y dim) (random (get-h dim))))
           (curr-quad (get-quad rand-x rand-y dim))
           (draw? (< (random 100) (get-prob curr-quad prob)))
           )
      (cond (draw?
             (let ((pos (make-posn rand-x rand-y)))
               ((draw-pixel window) pos colour)
               (set! count (+ count 1)))
             )))
     (if (> n 0)
        (iter (- n 1) count)
        (begin (display " : ")(display count)(newline)))
    )
  (iter n 0)
 )
  
(define (new-scale scale)
  (* scale scale))

(define (fill-random-fractal window dim prob n depth scale)
  (display "DEPTH: ")
  (display depth)
  (display "      Colour scale: ")
  (display scale)
  (newline)
  
  (cond ((> depth 0)
      (let* ((x (get-x dim))
            (y (get-y dim))
            (w (get-w dim))
            (h (get-h dim))
            (q1-dim (make-dim (+ x (round (/ w 2))) y (round (/ w 2)) (round (/ h 2))))
            (q2-dim (make-dim x y (round (/ w 2)) (round (/ h 2))))
            (q3-dim (make-dim x (+ y (round (/ h 2))) (round (/ w 2)) (round (/ h 2))))
            (q4-dim (make-dim (+ x (round (/ w 2))) (+ y (round (/ h 2))) (round (/ w 2)) (round (/ h 2))))
            (colour (make-rgb (- 1 scale) (- 1 scale) scale)) 
            )
        (fill-random window dim prob colour n)
        (fill-random-fractal window q1-dim (scale-prob prob (get-q1 prob)) (* n n-scale) (- depth 1) (new-scale scale))
        (fill-random-fractal window q2-dim (scale-prob prob (get-q2 prob)) (* n n-scale) (- depth 1) (new-scale scale))
        (fill-random-fractal window q3-dim (scale-prob prob (get-q3 prob)) (* n n-scale) (- depth 1) (new-scale scale))
        (fill-random-fractal window q4-dim (scale-prob prob (get-q4 prob)) (* n n-scale) (- depth 1) (new-scale scale)))
      ))
  )

(define (generate-sierpinski width height args)
  )